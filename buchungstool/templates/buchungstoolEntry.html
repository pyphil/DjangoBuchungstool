<!-- <head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
</head> -->
<style>
	.custom-width {
    width: 152px !important;
	}
</style>

{% extends 'base.html' %}  
{% block content %}

<div class="container">
  {% if buttontext == "" %}
    <h2>Eintrag hinzufügen</h2> 
  {% else %}
    <h2>Eintrag ändern:</strong></h2>
  {% endif %}
  <h5 class="mt-3"><strong>Datum: </strong>{{ date }}, {{ std }}. Stunde</h5>
  <h5 class="mt-3"><strong>Raum/Gerät:</strong> {{room_text}}</h5>
  <form action="{% url 'buchungstoolHome' %}" method="POST">
    {% csrf_token %}
    <div class="mb-3">
      <label class="mt-3" for="saveKrzl" class="form-label">Kürzel:</label>
      {% if buttontext == "" or warning_empty %}
        <input type="text" class="form-control mt-2" name="krzl" value="{{ krzl }}" />
      {% else %}
        <input type="text" class="form-control mt-2" name="krzl" value="{{ krzl }}" readonly>
      {% endif %}
      <label class="mt-3" for="saveLerngruppe" class="form-label">Buchen für Lerngruppe/Veranstaltung:</label>
      <input type="text" class="form-control mt-2" name="lerngruppe" value="{{ buttontext }}" />
      <input type="hidden" name="date" value="{{ isodate }}" />
      <!-- <input type="hidden" name="buttondate" value="{{ date }}" /> -->
      <!-- <input type="hidden" name="std" value="{{ std }}" /> -->
      <!-- <input type="hidden" name="room" value="{{ room }}" /> -->
      <!-- <input type="hidden" name="room_text" value="{{ room_text }}" /> -->
      <br>

      {% if buttontext != "" and not alert and not warning_empty%}
      {% elif warning_empty and update %}
      {% else %}
      <div class="accordion mb-5" id="accordionSerie">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
          {% if alert %}
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
          {% else %}
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
            data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
            Serientermin buchen
            </button>
          {% endif %}
          </h2>
        
          {% if alert %}
            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionSerie">
          {% else %}
            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionSerie">
          {% endif %}
              <div class="accordion-body">
                <div class="row align-items-center">
                  <div class="col-auto">
                    <label for="date"> Termin bis zu folgendem Datum <strong>wöchentlich wiederholen:</strong> </label>
                  </div>
                  <div class="col-2">
                    <select name="selection" class="form-select custom-width" aria-label="Default select example">  
                      {% for date in date_series %}
                        <option value="{{date.item}}">{{date.date}}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      {% if state == None %}
      {% else %}
      <div class="accordion mb-5" id="accordionUser"> 
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            {% if accordion == "open" %}
            <button class="accordion-button" type="button" data-bs-toggle="collapse"
            data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
            {% else %}
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
            data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
            {% endif %}
            Nutzerliste
            </button>
          </h2>
        
          {% if accordion == "open" %}
            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionSerie">
          {% else %}
            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionSerie">
          {% endif %}
              <div class="accordion-body">
                <div class="row mb-4">
                  <div class="col">
                    Eintrag in die Nutzerliste für Schüler*innen freischalten: 
                    <div class="btn-group" role="group" aria-label="Freischalten" title="Für die SuS ist der Eintrag nur am Tag der Buchung zu sehen. Der Eintrag sollte aber nur kurz während der Stunde frei- und wieder ausgeschaltet werden.">
                      {% if state == "on" %}
                      <button type="submit" name="freischalten" value="off" class="btn btn-outline-primary">OFF</button>
                      <button type="button" name="freischalten" value="on" class="btn btn-primary" style="background-color: #fd0d0d; border-color: #fd0d0d">ON</button>
                      {% else %}
                      <button type="button" name="freischalten" value="off" class="btn btn-primary">OFF</button>
                      <button type="submit" name="freischalten" value="on" class="btn btn-outline-primary">ON</button>
                      {% endif %}
                    </div>
                  </div>
                  <div class="col-auto text-end">
                    <button type="submit" name="reload" value="reload" class="btn btn-success" title="Die Seite neu laden, um Änderungen durch die SuS hier anzuzeigen">Neu Laden</button>
                  </div>
                </div>
                {% for user in userlist %}
                  <div class="row align-items-center mt-2">
                    <div class="col-auto mb-4">
                      <label for="date"><strong>{{user.iPad}}</strong></label>
                    </div>
                    <div class="col-2">
                      <input type="text" class="form-control" name="pencil_{{user.iPad}}" value="{{user.pencil}}"><small>Stift</small>
                    </div>
                    <div class="col">
                      <input type="text" class="form-control" name="student_{{user.iPad}}" value="{{user.student}}"><small>Schüler*innen (Vornamen mit Komma getrennt)</small>
                    </div>
                    <div class="col-auto mb-4">
                      <button type="submit" class="btn btn-primary" name="submit_student" value="{{user.iPad}}">Speichern</button>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      {% if alert %}
        <div class="alert alert-danger" role="alert">
          Das geht leider nicht. Folgende Termine sind bereits besetzt:
          {{ blocked_dates }} <br>
          Du kannst den ersten Termin buchen oder die Serie anpassen.
        </div>
      {% endif %}
        
        {% if warning_empty %}
          <div class="alert alert-danger" role="alert">
            Die Felder "Kürzel" und "Lerngruppe" müssen gefüllt sein.
          </div>
        {% endif %}

      {% if buttontext == "" and not warning_empty %}
        <button type="submit" name="save" value="save" class="btn btn-primary">Speichern</button>
      {% elif alert or warning_empty and not update %}
        <button type="submit" name="save" value="save" class="btn btn-primary">Speichern</button>
      {% else %}
        <button type="submit" name="update" value="update" class="btn btn-warning">Eintrag ändern</button>
        <button type="submit" class="btn btn-danger" name="delete" value="delete">Eintrag löschen</button>
      {% endif %}
      <button type="submit" class="btn btn-secondary" value="cancel" name="cancel">Abbrechen</button>
    </div>
  </form>
</div>

{% endblock content %}